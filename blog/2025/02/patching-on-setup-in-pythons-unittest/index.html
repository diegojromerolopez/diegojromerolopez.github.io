<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Patching on setUp in Python's unittest - Diego J.'s Software Tar Pit</title>
<meta name=description content="Patching on setUp in Python&rsquo;s unittest One of my favorite programming languages is Python, and I think that tests should be a foundational part of software development, so it is not strange that I delve a lot in Python&rsquo;s unittest.
In this post we are going to show how to use unittest.mock.patch not in a decorator (the usual case) but in the setUp method.
Why should you care about this? Well, I have not cared about this after more than a decade of working with python (intermittently), because I was just used to the patch decorator.">
<meta name=author content="Diego J. Romero-López"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Diego J.\u0027s Software Tar Pit","url":"https:\/\/diegojromerolopez.github.io"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/diegojromerolopez.github.io"}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/diegojromerolopez.github.io","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/diegojromerolopez.github.io\/blog\/2025\/02\/patching-on-setup-in-pythons-unittest\/","name":"Patching on set up in python\u0027s unittest"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Diego J. Romero-López"},"headline":"Patching on setUp in Python\u0027s unittest","description":"Patching on setUp in Python\u0026rsquo;s unittest One of my favorite programming languages is Python, and I think that tests should be a foundational part of software development, so it is not strange that I delve a lot in Python\u0026rsquo;s unittest.\nIn this post we are going to show how to use unittest.mock.patch not in a decorator (the usual case) but in the setUp method.\nWhy should you care about this? Well, I have not cared about this after more than a decade of working with python (intermittently), because I was just used to the patch decorator.","inLanguage":"en","wordCount":590,"datePublished":"2025-02-13T00:00:00","dateModified":"2025-02-13T00:00:00","image":"https:\/\/diegojromerolopez.github.io\/img\/diegoj-logo.png","keywords":["python, unittest"],"mainEntityOfPage":"https:\/\/diegojromerolopez.github.io\/blog\/2025\/02\/patching-on-setup-in-pythons-unittest\/","publisher":{"@type":"Organization","name":"https:\/\/diegojromerolopez.github.io","logo":{"@type":"ImageObject","url":"https:\/\/diegojromerolopez.github.io\/img\/diegoj-logo.png","height":60,"width":60}}}</script>
<meta property="og:title" content="Patching on setUp in Python's unittest">
<meta property="og:description" content="Patching on setUp in Python&rsquo;s unittest One of my favorite programming languages is Python, and I think that tests should be a foundational part of software development, so it is not strange that I delve a lot in Python&rsquo;s unittest.
In this post we are going to show how to use unittest.mock.patch not in a decorator (the usual case) but in the setUp method.
Why should you care about this? Well, I have not cared about this after more than a decade of working with python (intermittently), because I was just used to the patch decorator.">
<meta property="og:image" content="https://diegojromerolopez.github.io/img/diegoj-logo.png">
<meta property="og:url" content="https://diegojromerolopez.github.io/blog/2025/02/patching-on-setup-in-pythons-unittest/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Diego J.'s Software Tar Pit">
<meta name=twitter:title content="Patching on setUp in Python's unittest">
<meta name=twitter:description content="Patching on setUp in Python&rsquo;s unittest One of my favorite programming languages is Python, and I think that tests should be a foundational part of software development, so it is not strange that …">
<meta name=twitter:image content="https://diegojromerolopez.github.io/img/diegoj-logo.png">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:site content="@diegojromerolop">
<meta name=twitter:creator content="@diegojromerolop">
<link href=https://diegojromerolopez.github.io/img/favicon.ico rel=icon type=image/x-icon>
<meta name=generator content="Hugo 0.91.2">
<link rel=alternate href=https://diegojromerolopez.github.io/index.xml type=application/rss+xml title="Diego J.'s Software Tar Pit"><link rel=stylesheet href=https://diegojromerolopez.github.io/css/katex.min.css>
<link rel=stylesheet href=https://diegojromerolopez.github.io/fontawesome/css/all.css>
<link rel=stylesheet href=https://diegojromerolopez.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/main.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/fonts.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/syntax.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/codeblock.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/photoswipe.min.css>
<link rel=stylesheet href=https://diegojromerolopez.github.io/css/photoswipe.default-skin.min.css>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class=container-fluid>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://diegojromerolopez.github.io>Diego J.'s Software Tar Pit</a>
</div>
<div class="collapse navbar-collapse" id=main-navbar>
<ul class="nav navbar-nav navbar-right">
<li>
<a title=Blog href=/>Blog</a>
</li>
<li>
<a title=About href=/page/about/>About</a>
</li>
<li>
<a title=Tags href=/tags>Tags</a>
</li>
<li>
<a href=/es lang=es>es</a>
</li>
</ul>
</div>
<div class=avatar-container>
<div class=avatar-img-border>
<a title="Diego J.'s Software Tar Pit" href=https://diegojromerolopez.github.io>
<img class=avatar-img src=https://diegojromerolopez.github.io/img/diegoj-logo.png alt="Diego J.'s Software Tar Pit">
</a>
</div>
</div>
</div>
</nav>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header class=header-section>
<div class="intro-header no-img">
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class=post-heading>
<h1>Patching on setUp in Python's unittest</h1>
<span class=post-meta>
<i class="fas fa-calendar"></i>&nbsp;Posted on February 13, 2025
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Diego J. Romero-López
</span>
</div>
</div>
</div>
</div>
</div>
</header>
<div class=container role=main>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<article role=main class=blog-post>
<h1 id=patching-on-setup-in-pythons-unittest>Patching on setUp in Python&rsquo;s unittest</h1>
<p>One of my favorite programming languages is Python,
and I think that tests should be a foundational part
of software development, so it is not strange that I
delve a lot in Python&rsquo;s unittest.</p>
<p>In this post we are going to show how to use <code>unittest.mock.patch</code>
not in a decorator (the usual case) but in the <code>setUp</code> method.</p>
<h2 id=why-should-you-care-about-this>Why should you care about this?</h2>
<p>Well, I have not cared about this after more than a decade of
working with python (intermittently), because I was just used
to the patch decorator. However, we can stop repeating the code
and save some precious space (and possible bugs) if we just
re-use the code by injecting some code in the <code>setUp</code> method.</p>
<h2 id=but-i-use-pytest-so-i-am-not-interested-in-this>But I use pytest so I am not interested in this</h2>
<p>I would rather have the minimal dependencies
in my projects and not depend on any package that is not needed 100%.</p>
<p><a href=https://docs.python.org/3/library/unittest.html>unittest</a> comes from
the standard library of Python so I prefer to use it
unless there is a hard requirement to use pytest.</p>
<p>However, <em>to each its own</em>, if you are happy with pytest that is perfect
and I am glad you feel that way.</p>
<h2 id=what-is-this-setup-method>What is this setUp method?</h2>
<p>There are two methods for preparing the environment for the test in unittest:</p>
<ul>
<li><code>setUp</code> runs before each test.</li>
<li><code>setUpClass</code> runs once before all tests.</li>
</ul>
<p>In our case we are going to assign to the implicit object (<code>self</code>) some mocks
to have it ready for each test method.</p>
<p>Analogously there are two methods for cleaning up the resources we have initialized:</p>
<ul>
<li><code>tearDown</code> runs after each test.</li>
<li><code>tearDownClass</code> runs once after all tests.</li>
</ul>
<p>By the way, notice that the methods are camelCase, hence not following the
snake_case convention.</p>
<h2 id=how-can-i-patch-methodsclasses-in-setup>How can I patch methods/classes in setup?</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> unittest


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestCase</span>(unittest<span style=color:#f92672>.</span>TestCase):
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>setUp</span>(self):
        my_patcher <span style=color:#f92672>=</span> patch(<span style=color:#e6db74>&#39;module.path.object&#39;</span>)
        self<span style=color:#f92672>.</span>mock_func <span style=color:#f92672>=</span> my_patcher<span style=color:#f92672>.</span>start()
        self<span style=color:#f92672>.</span>addCleanup(my_patcher<span style=color:#f92672>.</span>stop)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test</span>(self):
        self<span style=color:#f92672>.</span>mock_func<span style=color:#f92672>.</span>return_value <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>

        function_that_calls_to_module_path_object()

        self<span style=color:#f92672>.</span>assertEqual([call()], self<span style=color:#f92672>.</span>mock_func<span style=color:#f92672>.</span>call_args_list)

</code></pre></div><h3 id=an-example-patching-get-requests>An example: patching GET requests</h3>
<p>Let suppose we are building a dictionary wrapper and we are going to query the <code>dictionaryapi.dev</code> API.</p>
<p>We first create a function to get word definitions:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># dictionary/definition.py</span>
<span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any

<span style=color:#f92672>import</span> requests


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_word_definition</span>(word: str) <span style=color:#f92672>-&gt;</span> list[dict[str, Any]]:
    <span style=color:#66d9ef>try</span>:
        response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;https://api.dictionaryapi.dev/api/v2/entries/en/</span><span style=color:#e6db74>{</span>word<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
        <span style=color:#66d9ef>return</span> response<span style=color:#f92672>.</span>json()
    <span style=color:#66d9ef>except</span> RequestException <span style=color:#66d9ef>as</span> exception:
        <span style=color:#66d9ef>raise</span> DictionaryException(
            <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Word meaning for </span><span style=color:#e6db74>{</span>word<span style=color:#e6db74>}</span><span style=color:#e6db74> could not be obtained. Exception: </span><span style=color:#e6db74>{</span>exception<span style=color:#f92672>.</span>__class__<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>
        ) <span style=color:#f92672>from</span> exception
</code></pre></div><p>But we want to test that we call to the get method of requests and that, in case of an exception,
we are prepared:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># dictionary/tests/test_definition.py</span>
<span style=color:#f92672>import</span> unittest
<span style=color:#f92672>from</span> unittest.mock <span style=color:#f92672>import</span> MagicMock, patch

<span style=color:#f92672>from</span> requests.exceptions <span style=color:#f92672>import</span> Timeout

<span style=color:#f92672>from</span> dictionary.definition <span style=color:#f92672>import</span> get_word_definition, DictionaryException


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestDefinition</span>(unittest<span style=color:#f92672>.</span>TestCase):
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>setUp</span>(self):
        requests_patcher <span style=color:#f92672>=</span> patch(<span style=color:#e6db74>&#39;dictionary.definition.requests&#39;</span>)
        self<span style=color:#f92672>.</span>mock_requests <span style=color:#f92672>=</span> requests_patcher<span style=color:#f92672>.</span>start()
        self<span style=color:#f92672>.</span>addCleanup(mock_requests<span style=color:#f92672>.</span>stop)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_get_word_definition_success</span>(self):
        expected_response <span style=color:#f92672>=</span> [
            {
                <span style=color:#e6db74>&#39;word&#39;</span>: <span style=color:#e6db74>&#39;house&#39;</span>
            }
        ]

        word <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;house&#39;</span>

        mock_response <span style=color:#f92672>=</span> MagicMock()
        mock_response<span style=color:#f92672>.</span>json<span style=color:#f92672>.</span>return_value <span style=color:#f92672>=</span> expected_response
        self<span style=color:#f92672>.</span>mock_requests<span style=color:#f92672>.</span>get<span style=color:#f92672>.</span>return_value <span style=color:#f92672>=</span> mock_response

        response <span style=color:#f92672>=</span> get_word_definition(word)

        self<span style=color:#f92672>.</span>assertEqual(expected_response, response)
        self<span style=color:#f92672>.</span>assertEqual([call(word)], self<span style=color:#f92672>.</span>mock_requests<span style=color:#f92672>.</span>get<span style=color:#f92672>.</span>call_args_list)
        self<span style=color:#f92672>.</span>assertEqual([call()], mock_response<span style=color:#f92672>.</span>json<span style=color:#f92672>.</span>call_args_list)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_get_word_definition_timeout</span>(self):
        word <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;house&#39;</span>

        self<span style=color:#f92672>.</span>mock_requests<span style=color:#f92672>.</span>get<span style=color:#f92672>.</span>side_effect <span style=color:#f92672>=</span> Timeout()

        <span style=color:#66d9ef>with</span> self<span style=color:#f92672>.</span>assertRaises(DictionaryException) <span style=color:#66d9ef>as</span> context:
            get_word_definition(word)

        self<span style=color:#f92672>.</span>assertEqual(
            <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Word meaning for </span><span style=color:#e6db74>{</span>word<span style=color:#e6db74>}</span><span style=color:#e6db74> could not be obtained. Exception: Timeout&#39;</span>,
            str(context<span style=color:#f92672>.</span>exception)
        )
        self<span style=color:#f92672>.</span>assertEqual([call(word)], self<span style=color:#f92672>.</span>mock_requests<span style=color:#f92672>.</span>get<span style=color:#f92672>.</span>call_args_list)
</code></pre></div><p>As you see above, we have a <code>self.mock_requests</code> instance attribute that contains
a mock to the requests library. In this case you could argue that the gains are not
much, but imagine if the <code>get_word_definition</code> would have 3 dependencies that need
to be tested, so you could save a lot of repeated code by using this technique.</p>
<h2 id=conclusion>Conclusion</h2>
<p>We have shown how to patch in the setUp method, this is useful for sharing
mocks between several tests, hence keeping the minimal code in each one
of the test methods.</p>
<div class=blog-tags>
<a href=https://diegojromerolopez.github.io/tags/python/>python</a>&nbsp;
<a href=https://diegojromerolopez.github.io/tags/unittest/>unittest</a>&nbsp;
</div>
</article>
<ul class="pager blog-pager">
<li class=previous>
<a href=https://diegojromerolopez.github.io/blog/2025/01/the-world-is-full-of-irrational-people/ data-toggle=tooltip data-placement=top title="The world is full of irrational people">&larr; Previous Post</a>
</li>
<li class=next>
<a href=https://diegojromerolopez.github.io/blog/2025/02/joining-test-coverage-in-several-test-directories/ data-toggle=tooltip data-placement=top title="Joining test coverage in several test directories">Next Post &rarr;</a>
</li>
</ul>
</div>
</div>
</div>
<footer>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
<li>
<a href=mailto:diegojromerolopez@gmail.com title="Email me">
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://github.com/diegojromerolopez title=GitHub>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://twitter.com/diegojromerolop title=Twitter>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://linkedin.com/in/diegojromerolopez title=LinkedIn>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href title=RSS>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="credits copyright text-muted">
Diego J. Romero-López
&nbsp;&bull;&nbsp;&copy;
2025
&nbsp;&bull;&nbsp;
<a href=https://diegojromerolopez.github.io>Diego J.'s Software Tar Pit</a>
</p>
<p class="credits theme-by text-muted">
<a href=https://gohugo.io>Hugo v0.91.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
</p>
</div>
</div>
</div>
</footer><script src=https://diegojromerolopez.github.io/js/katex.min.js></script>
<script src=https://diegojromerolopez.github.io/js/auto-render.min.js></script>
<script src=https://diegojromerolopez.github.io/js/jquery-3.5.1.slim.min.js></script>
<script src=https://diegojromerolopez.github.io/js/bootstrap.min.js></script>
<script src=https://diegojromerolopez.github.io/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://diegojromerolopez.github.io/js/photoswipe.min.js></script>
<script src=https://diegojromerolopez.github.io/js/photoswipe-ui-default.min.js></script><script src=https://diegojromerolopez.github.io/js/load-photoswipe.js></script>
</body>
</html>