<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>How to manage docker secrets - Diego J.'s Software Tar Pit</title>
<meta name=description content="How to manage docker secrets The product that is produced by most software developer teams is a docker image. How can be sure that we are not leaking secrets in docker images? If we include them as building arguments for sure they are going to be stored in the own image. Is there any way to avoid having them inside the docker image?
Introduction Suppose you have a docker image that requires a secret, you do not want to include it in the image, but you need during the process of building the image.">
<meta name=author content="Diego J. Romero-López"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Diego J.\u0027s Software Tar Pit","url":"https:\/\/diegojromerolopez.github.io"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/diegojromerolopez.github.io"}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/diegojromerolopez.github.io","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/diegojromerolopez.github.io\/blog\/2023\/08\/how-to-manage-docker-secrets\/","name":"How to manage docker secrets"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Diego J. Romero-López"},"headline":"How to manage docker secrets","description":"How to manage docker secrets The product that is produced by most software developer teams is a docker image. How can be sure that we are not leaking secrets in docker images? If we include them as building arguments for sure they are going to be stored in the own image. Is there any way to avoid having them inside the docker image?\nIntroduction Suppose you have a docker image that requires a secret, you do not want to include it in the image, but you need during the process of building the image.","inLanguage":"en","wordCount":402,"datePublished":"2023-08-12T00:00:00","dateModified":"2023-08-12T00:00:00","image":"https:\/\/diegojromerolopez.github.io\/img\/diegoj-logo.png","keywords":["docker, secrets, security"],"mainEntityOfPage":"https:\/\/diegojromerolopez.github.io\/blog\/2023\/08\/how-to-manage-docker-secrets\/","publisher":{"@type":"Organization","name":"https:\/\/diegojromerolopez.github.io","logo":{"@type":"ImageObject","url":"https:\/\/diegojromerolopez.github.io\/img\/diegoj-logo.png","height":60,"width":60}}}</script>
<meta property="og:title" content="How to manage docker secrets">
<meta property="og:description" content="How to manage docker secrets The product that is produced by most software developer teams is a docker image. How can be sure that we are not leaking secrets in docker images? If we include them as building arguments for sure they are going to be stored in the own image. Is there any way to avoid having them inside the docker image?
Introduction Suppose you have a docker image that requires a secret, you do not want to include it in the image, but you need during the process of building the image.">
<meta property="og:image" content="https://diegojromerolopez.github.io/img/diegoj-logo.png">
<meta property="og:url" content="https://diegojromerolopez.github.io/blog/2023/08/how-to-manage-docker-secrets/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Diego J.'s Software Tar Pit">
<meta name=twitter:title content="How to manage docker secrets">
<meta name=twitter:description content="How to manage docker secrets The product that is produced by most software developer teams is a docker image. How can be sure that we are not leaking secrets in docker images? If we include them as …">
<meta name=twitter:image content="https://diegojromerolopez.github.io/img/diegoj-logo.png">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:site content="@diegojromerolop">
<meta name=twitter:creator content="@diegojromerolop">
<link href=https://diegojromerolopez.github.io/img/favicon.ico rel=icon type=image/x-icon>
<meta name=generator content="Hugo 0.91.2">
<link rel=alternate href=https://diegojromerolopez.github.io/index.xml type=application/rss+xml title="Diego J.'s Software Tar Pit"><link rel=stylesheet href=https://diegojromerolopez.github.io/css/katex.min.css>
<link rel=stylesheet href=https://diegojromerolopez.github.io/fontawesome/css/all.css>
<link rel=stylesheet href=https://diegojromerolopez.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/main.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/fonts.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/syntax.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/codeblock.css><link rel=stylesheet href=https://diegojromerolopez.github.io/css/photoswipe.min.css>
<link rel=stylesheet href=https://diegojromerolopez.github.io/css/photoswipe.default-skin.min.css>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class=container-fluid>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://diegojromerolopez.github.io>Diego J.'s Software Tar Pit</a>
</div>
<div class="collapse navbar-collapse" id=main-navbar>
<ul class="nav navbar-nav navbar-right">
<li>
<a title=Blog href=/>Blog</a>
</li>
<li>
<a title=About href=/page/about/>About</a>
</li>
<li>
<a title=Tags href=/tags>Tags</a>
</li>
<li>
<a href=/es lang=es>es</a>
</li>
</ul>
</div>
<div class=avatar-container>
<div class=avatar-img-border>
<a title="Diego J.'s Software Tar Pit" href=https://diegojromerolopez.github.io>
<img class=avatar-img src=https://diegojromerolopez.github.io/img/diegoj-logo.png alt="Diego J.'s Software Tar Pit">
</a>
</div>
</div>
</div>
</nav>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header class=header-section>
<div class="intro-header no-img">
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class=post-heading>
<h1>How to manage docker secrets</h1>
<span class=post-meta>
<i class="fas fa-calendar"></i>&nbsp;Posted on August 12, 2023
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Diego J. Romero-López
</span>
</div>
</div>
</div>
</div>
</div>
</header>
<div class=container role=main>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<article role=main class=blog-post>
<h1 id=how-to-manage-docker-secrets>How to manage docker secrets</h1>
<p>The product that is produced by most software developer teams is a docker image.
How can be sure that we are not leaking secrets in docker images? If we include
them as building arguments for sure they are going to be stored in the own image.
Is there any way to avoid having them inside the docker image?</p>
<h2 id=introduction>Introduction</h2>
<p>Suppose you have a docker image that requires a secret, you do not want to include
it in the image, but you need during the process of building the image. In other words,
you cannot pass the secrets as environment variables because you need during the
construction of the image, not when running a container based on that image.</p>
<p>A good way of checking what we have in each layer of the docker image is use the tool
<a href=https://github.com/wagoodman/dive>dive</a>.</p>
<p>Anyway, let us continue with Docker and secrets.</p>
<h2 id=docker-secrets>Docker secrets</h2>
<p>Docker support the use of <a href=https://docs.docker.com/engine/swarm/secrets/>secrets</a>, and
that is the easiest way of including secrets to your docker images.</p>
<p>First, you can use secrets while building docker images using the build command:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>DOCKER_BUILDKIT<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>docker build --secret id<span style=color:#f92672>=</span>my_env_secret,env<span style=color:#f92672>=</span>MY_ENV_SECRET .
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>DOCKER_BUILDKIT<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>docker build --secret id<span style=color:#f92672>=</span>my_env_secret,src<span style=color:#f92672>=</span>my_secret_file .
</code></pre></div><p>Second, you can include secrets in your
<a href=https://docs.docker.com/compose/use-secrets/>docker-compose.yml</a> file:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.8&#34;</span>

<span style=color:#f92672>services</span>:
  <span style=color:#f92672>app</span>:
    <span style=color:#f92672>build</span>: <span style=color:#ae81ff>app:latest</span>
    <span style=color:#f92672>secrets</span>:
      - <span style=color:#ae81ff>my_file_secret</span>
      - <span style=color:#ae81ff>my_env_secret</span>

<span style=color:#f92672>secrets</span>:
  <span style=color:#f92672>my_file_secret</span>:
    <span style=color:#f92672>file</span>: <span style=color:#ae81ff>./my_file_secret.txt</span>
  <span style=color:#f92672>my_env_secret</span>:
    <span style=color:#f92672>env</span>: <span style=color:#e6db74>&#34;MY_ENV_SECRET_VARIABLE&#34;</span>
</code></pre></div><p>As long as you have a my_file_secret.txt file with the secret and a MY_ENV_SECRET_VARIABLE
environment variable with the other secret, you only need to include the
secret in your Dockerfile file:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>secret,id<span style=color:#f92672>=</span>my_env_secret <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    MY_ENV_SECRET<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /run/secrets/my_env_secret<span style=color:#66d9ef>)</span> &lt;command that uses the my_env_secret&gt;<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>Notice that it is the same with the <em>file</em> secret but replacing my_env_secret by my_file_secret.</p>
<p>Where <code>&lt;command that uses the my_env_secret></code> is just a command that uses the secret, for example, and installation of a private python package:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>secret,id<span style=color:#f92672>=</span>my_env_secret <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     pip install https://user:<span style=color:#66d9ef>$(</span>cat /run/secrets/my_env_secret<span style=color:#66d9ef>)</span>@artifactory.example.com/artifactory/team/package-1.1-py3-none-any.whl<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>The same can be done with the my_file_secret, but I am not going to lie to you. I prefer
to use environment secrets as it is easier to deal with environment variables than with
files.</p>
<p>Anyway, once you have it you are all set and can build the docker image:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>docker compose build app
</code></pre></div><h2 id=conclussion>Conclussion</h2>
<p>Never passs secrets as build-args as they will be visible in the docker image layers.
That is less than ideal as the secrets stop being secrets. Use the secrets functionality
of docker to have actually secret variables.</p>
<div class=blog-tags>
<a href=https://diegojromerolopez.github.io/tags/docker/>docker</a>&nbsp;
<a href=https://diegojromerolopez.github.io/tags/secrets/>secrets</a>&nbsp;
<a href=https://diegojromerolopez.github.io/tags/security/>security</a>&nbsp;
</div>
</article>
<ul class="pager blog-pager">
<li class=previous>
<a href=https://diegojromerolopez.github.io/blog/2023/06/software-engineer-programmer-or-wizard/ data-toggle=tooltip data-placement=top title="Software engineer, programmer or wizard">&larr; Previous Post</a>
</li>
</ul>
</div>
</div>
</div>
<footer>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
<li>
<a href=mailto:diegojromerolopez@gmail.com title="Email me">
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://github.com/diegojromerolopez title=GitHub>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://twitter.com/diegojromerolop title=Twitter>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://linkedin.com/in/diegojromerolopez title=LinkedIn>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href title=RSS>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="credits copyright text-muted">
Diego J. Romero-López
&nbsp;&bull;&nbsp;&copy;
2023
&nbsp;&bull;&nbsp;
<a href=https://diegojromerolopez.github.io>Diego J.'s Software Tar Pit</a>
</p>
<p class="credits theme-by text-muted">
<a href=https://gohugo.io>Hugo v0.91.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
</p>
</div>
</div>
</div>
</footer><script src=https://diegojromerolopez.github.io/js/katex.min.js></script>
<script src=https://diegojromerolopez.github.io/js/auto-render.min.js></script>
<script src=https://diegojromerolopez.github.io/js/jquery-3.5.1.slim.min.js></script>
<script src=https://diegojromerolopez.github.io/js/bootstrap.min.js></script>
<script src=https://diegojromerolopez.github.io/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://diegojromerolopez.github.io/js/photoswipe.min.js></script>
<script src=https://diegojromerolopez.github.io/js/photoswipe-ui-default.min.js></script><script src=https://diegojromerolopez.github.io/js/load-photoswipe.js></script>
</body>
</html>